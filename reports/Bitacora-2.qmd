---
title: "Bitacora 2"
format:
  html: default
  pdf: default
editor: visual
---

# Bitácora 2 Proyecto Grupal

```{r include = FALSE}

#setup
library(dplyr)
library(readr)
library(here)
library(ggplot2)
library(sf)
library(stringr)
library(tidyverse)



ruta <- here("data", "processed", "Estadísticas Policiales 2019 a Julio 2025.csv")

datos <- read_csv(ruta)


# Vista general
n.filas <- nrow(datos)
n.cols <- ncol(datos)
variables <- names(datos)
rango.fechas <- range(datos$fecha, na.rm = TRUE)

#Ordenar por orden cronólogico los sucesos 

```

## 1

### Características de los datos

Se utilizaron las bases de datos de crímenes registrados entre 2019 y julio de 2025, disponibles en el portal de datos del Poder Judicial: <https://sitiooij.poder-judicial.go.cr/index.php/ayuda/servicios-policiales/servicios-a-organizaciones/indice-de-transparencia-del-sector-publico-costarricense/datos-abiertos>.

En este sentido, estas bases venían separadas por año y presentaban algunas inconsistencias entre ellas. Por ejemplo, entre 2019 y 2023 la variable del sexo se denominaba “género”, mientras que a partir de 2024 pasó a llamarse “sexo”. Asimismo, la columna de fecha aparecía en formato *char* en algunos años y en formato *Date* en otros.

Para resolver esto, se unificaron los datos, combinando todos los archivos en una única base que incluye todos los crímenes registrados en el periodo 2019–julio 2025.

De esta forma, resultó una base de datos con las siguientes características:

-   Tamaño: `{r} n.filas` x `{r} n.cols`.
-   Va de `{r} rango.fechas[1]` a `{r} rango.fechas[2]`.
-   Todas las variables son cualitativas: `{r} variables`.

### Población de estudio

La población de estudio corresponde a todos los eventos delictivos ocurridos en Costa Rica de 2019 a julio de 2025.

### Muestra observada

La muestra son las observaciones registradas de delitos en Costa Rica del 01/01/2019 a las 00:00:00 al 31/07/25 a las 23:59:59, almacenadas en la base del Poder Judicial.

### Unidad estadística

Corresponde a cada observación de delito junto con sus atributos: `{r} variables`

### Variables de estudio

| Variable | Tipo | Descripción |
|------------------------|------------------------|------------------------|
| fecha | Fecha | Día del evento |
| hora | Categórica | Tramos horarios de 3 horas |
| delito | Categórica | Categoría principal del hecho |
| subdelito | Categórica | Subtipo de delito |
| victima | Categórica | Tipo de víctima (pueden ser objetos como VIVIENDA o VEHÍCULO). |
| subvictima | Categórica | Subtipo de víctima |
| sexo | Categórica | Sexo de la víctima. |
| edad | Categórica | Edad de la víctima. |
| nacionalidad | Categórica | Nacionalidad de la víctima. |
| provincia | Categórica | Provincia donde ocurrió el hecho |
| canton | Categórica | Cantón donde ocurrió el hecho |
| distrito | Categórica | Distrito donde ocurrió el hecho |

**Es importante recalcar que las bases de datos traen columnas correspondientes a persona (edad, sexo, nacionalidad) incluso cuando victima es VEHICULO, VIVIENDA, EDIFICACION, etc; lo cual se puede deber a valores por defecto de captura. Para un correcto análisis se coloca NA en dichas posiciones. Aqui se muestra un ejemplo de como quedarían los datos aplicando estos cambios:**

```{r}
datos %>% 
  select(victima, subvictima, edad, sexo, nacionalidad) %>% 
  filter(victima != "PERSONA") %>% 
  slice_head(n = 10)
```

## 2

Se agregan las primeras 5 filas de nuestra base de datos:

```{r}

slice_head(datos, n = 5)
```

## 3

Uno de los principales retos encontrados en esta base de datos, es que todas las variables de la misma son categóricas. Es decir, no hay ninguna variable cuantitativa. Incluso la variable de edad, se divide en pocas categorias (NO APLICA, ADULTO MAYOR, MAYOR DE EDAD, MENOR DE EDAD, DESCONOCIDO)

Entonces, para afrontar este reto, se realiza una distribucion de frecuencias como la que se ha mostrado anteriormente. De esta manera, se puede analizar, retomando el caso de la edad por ejemplo, la frecuencia de cada categoria. Pero, se analiza cada variable de acuerdo al orden de la base de datos:

```{r}
resumen_delito <-  read_csv(here("data/processed/resumen_delito.csv"), show_col_types = FALSE)
resumen_delito
```

Estos son los 10 delitos que más frecuencia ha tenido en el pais en los ultimos seis años, aunque no se debe descartar que hay mas de 30 tipos de delitos reportados en los ultimos seis años. Lideran el hurto, asalto, robo, los delitos contra la propiedad y el vehículo como los cinco delitos más frecuentes. Por lo que se puede entender que hay una tendencia hacia los delitos reportados que implican el robo de un bien.

```{r}
resumen_victima <-  read_csv(here("data/processed/resumen_victima.csv"), show_col_types = FALSE)
resumen_victima
```

Con respecto a las víctimas, aproximadamente la mitad de las víctimas de los delitos reportados son personas. Note quel total de víctimas de personas se relaciona con los primeros tres delitos más reportados (Hurto, asalto y robo). Seguido de los vehículos (Robo de vehículos), la vivienda y edificaciones (Delitos contra la propiedad) y los otros. Para efectos de esta investigación, el foco de atención se centra en las víctimas que son personas.

```{r}
resumen_edad <-  read_csv(here("data/processed/resumen_edad.csv"), show_col_types = FALSE)
resumen_edad
```

De acuerdo a las frecuencias, se interpretan las mismas como rangos de edad. Más de la mitad de las víctimas no son personas (Como se observa en el cuadro de víctimas), por lo que, las personas mayores de edad son las que más reportan delitos que ocurren en contra de sí mismas. También se puede observar que bajo los mayores de edad, se encuentran los menores; por lo que han habido más de 10 000 víctimas menores de edad en los últimos 6 años. En menor frecuencia los adultos mayores, y por último, más de 7000 casos con edad no registrada.

```{r}
resumen_sexo <-  read_csv(here("data/processed/resumen_sexo.csv"), show_col_types = FALSE)
resumen_sexo
```

Análogamente con la edad, hay exactamente 185975 casos donde las víctimas no son personas. Por ende, solo hay registro de más de 58 mil hombres víctimas de delitos, y más de 34 mil víctimas mujeres. Se desconoce el sexo de 66000 casos aproximadamente.

```{r}
resumen_nacionalidad <-  read_csv(here("data/processed/resumen_nacionalidad.csv"), show_col_types = FALSE)
resumen_nacionalidad
```

Obviando los casos donde las víctimas no son personas, aproximadamente el 37% de las víctimas son de nacionalidad costarricense, seguidamente del 5% de las víctimas, que son nicaraguenses, el 1,36% son casos no registrados y el 0,55% de víctimas han sido estadounidenses.

```{r}
resumen_provincia <-  read_csv(here("data/processed/resumen_provincia.csv"), show_col_types = FALSE)
resumen_provincia
```

Acá se puede observar la frecuencia de delitos cometidos de acuerdo a la provincia. Siendo la capital la provincia donde más se reportan delitos, seguido de Alajuela, con una diferencia de reporte de delitos de 75612 casos, una variación muy alta, a diferencia de las siguientes provincias. Por último, Cartago, la provincia donde menos se reportan delitos, y 29 casos de los que no se tiene información.

## 4

Se ha hecho un grafico de la distribucion de cada tabla de frecuencia. Aca se muestran las mas relevantes

Variable delito

```{r}
grafico_delito <- resumen_delito %>% 
  arrange(desc(frecuencia_de_delitos)) %>% 
  mutate(delito = factor(delito, levels = delito)) %>% 
  ggplot(aes(x =delito, y = frecuencia_de_delitos, fil = delito)) +
  geom_bar(stat = "identity", fill = "skyblue", show.legend = FALSE) +
  coord_flip() +
  labs(
    title = "10 delitos ocurridos más frecuentres en Costa Rica entre 2019 y 2025", 
    x = "Delito",
    y = "Frecuencia"
  ) +
  theme_minimal()
grafico_delito
```

Variable victima

```{r}
grafico_victima <- resumen_victima %>% 
  mutate(victima = factor(victima, levels = victima)) %>% 
  ggplot(aes(x = victima, y = frecuencia_de_victimas)) +
  geom_bar(stat = "identity", fill = "darkorchid4") +
  coord_flip()+
  labs(title = "Victimas más frecuentes de un delito en Costa Rica entre 2019 y 2025") +
  theme_minimal()
#Guardamos
ggsave(
  filename = here("info", "graphics", "grafico_victima.png"),
  plot = grafico_victima, 
  width = 15, height = 10, dpi = 200
)
grafico_victima
```

Variable sexo

```{r}
grafico_sexo <- resumen_sexo %>% 
  mutate(sexo = factor(sexo, levels = sexo)) %>% 
  ggplot(aes(x = sexo, y = frecuencia_de_sexo)) +
  geom_bar(stat = "identity", fill = "chocolate3" ) +
  coord_flip() +
  labs(title = "Variación del sexo de la víctima de un delito en Costa Rica entre 2019 y 2025",
       x = "Sexo",
       y = "Frecuencia") +
  theme_minimal()
#Guardamos
ggsave(
  filename = here("info", "graphics", "grafico_sexo.png"),
  plot = grafico_sexo, 
  width = 15, height = 10, dpi = 200
)
grafico_sexo
```

Variable canton

```{r}
resumen_canton <- datos %>% 
  count(canton, name = "frecuencia_de_cantones") %>% 
  arrange(desc(frecuencia_de_cantones))

resumen_canton <- resumen_canton %>% 
  filter(canton != "DESCONOCIDO")

cantones <- st_read("../data_raw/shapefiles/unidad_geoestadistica_cantonal_ugec_2024.shp",quiet = TRUE)

cantones <- cantones  %>% 
  mutate(nomb_ugec = str_to_upper(nomb_ugec),
         nomb_ugec = str_replace_all(nomb_ugec, c(
           "Á" = "A", "É" = "E", "Í" = "I", "Ó" = "O", "Ú" = "U", "Ñ" = "N"
         )))

cantones <- cantones %>% 
  left_join(resumen_canton, by = c("nomb_ugec"= "canton"))

grafico_cantones <- ggplot(cantones) +
  geom_sf(aes(fill = frecuencia_de_cantones), color = "white") +
  scale_fill_viridis_c(option = "plasma") +
  labs(title = "Frecuencia de reportes de delito por canton en Costa Rica entre 2019 y 2025", fill = "Frecuencia")
grafico_cantones
```

## 5

Al ser variables categoricas, se debe de tener coherencia a la hora de comparar variables.

En este caso, se compara primero, la variable de provincia con la de delito, es decir, contabilizar los distintos tipos de delitos que ocurren en Costa Rica en funcion a su provincia:

```{r}
ruta.entrada <- here("data", "processed", "Estadísticas Policiales 2019 a Julio 2025.csv")
datos <- read_csv(ruta.entrada, show_col_types = FALSE)

#Df enfocaddo en relacionar los delitos por provincia
filtro <- datos %>% 
  filter(!provincia %in% c("DESCONOCIDO", "NO APLICA"),
         delito != "DESCONOCIDO")

delitos_mas_frecuentes <-  filtro %>% 
  group_by(delito) %>% 
  summarise(frecuencia.delito = n(), .groups = "drop") %>% 
  arrange(desc(frecuencia.delito)) %>% 
  slice_head(n = 10) %>% 
  pull(delito)

delito_provincia <- filtro %>% 
  filter(delito %in% delitos_mas_frecuentes) %>% 
  group_by(provincia, delito) %>% 
  summarise(frecuencia = n(), .groups = "drop") %>% 
  mutate(provincia = factor(provincia), delito = factor(delito))

#Relacion entre fechas y provincias
grafico_delito_provincia <- delito_provincia %>% 
  ggplot(aes(x = provincia, y = frecuencia, fill = delito)) +
  geom_bar(stat ="identity") +
  coord_flip() +
  labs(title = "Delitos por provincia en Costa Rica entre 2019 y 2025",
       x = "Provincia",
       y ="Frecuencia")

grafico_delito_provincia
```

Ahora, la relacion entre la variable sexo y edad. Es decir, la distribucion de los rangos de edad de acuerdo al sexo que han reportado un delito en Costa Rica entre 2019 y 2025:

```{r}

resumen_sexo_edad <- datos %>%
  filter(!edad %in% c("DESCONOCIDO", "NO APLICA"),
         !sexo %in% c("DESCONOCIDO", "NO APLICA")) %>% 
  group_by(sexo, edad) %>% 
  summarise(frecuencia = n(), .groups = "drop")

#Grafico
grafico_sexo_edad <- resumen_sexo_edad %>% 
  ggplot(aes(x = edad, y = frecuencia, fill = sexo)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = c("HOMBRE" = "blue4", "MUJER" = "pink3")) +
  labs(title = "Distribucion de victimas de un delito en Costa Rica en funcion del sexo y la edad",
       x = "Rangos de edad",
       y = "Frecuencia") +
  theme_minimal()
grafico_sexo_edad
```

## Bibliografia

\
[https://rpubs.com/Juve_Campos/ImagenesyMultimediaEnRmarkdown](#0)\
\
<https://ggplot2.tidyverse.org/reference/coord_flip.html>\
\
<https://es.scribd.com/document/432904420/Paleta-de-Colores-en-R>\
[\
https://mapscaping.com/read-write-shapefiles-in-r/](https://mapscaping.com/read-write-shapefiles-in-r/)

<https://r-charts.com/es/espacial/mapa-burbujas/>
