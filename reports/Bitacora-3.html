<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bitacora 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Bitacora-3_files/libs/clipboard/clipboard.min.js"></script>
<script src="Bitacora-3_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Bitacora-3_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Bitacora-3_files/libs/quarto-html/popper.min.js"></script>
<script src="Bitacora-3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Bitacora-3_files/libs/quarto-html/anchor.min.js"></script>
<link href="Bitacora-3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Bitacora-3_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Bitacora-3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Bitacora-3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Bitacora-3_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Bitacora-3.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bitacora 3</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="bitácora-3-proyecto-grupal" class="level1">
<h1>Bitácora 3 Proyecto Grupal</h1>
<p>Integrantes:</p>
<ul>
<li>Sebastián Calderón Segura C21517</li>
<li>Sebastián Miranda Ramírez C4H274</li>
<li>Josué Gustavo Rodríguez Aguilar C4J023</li>
<li>Kevin David Calderon Martínez C4D511</li>
<li>Santiago Paniagua Chavarría C4I249</li>
</ul>
<section id="planteamiento-del-problema" class="level2">
<h2 class="anchored" data-anchor-id="planteamiento-del-problema">1 Planteamiento del problema:</h2>
<p>Posterior a la limpieza exhausiva de datos, se procede con la pregunta de investigación que funcionará como guía para el análisis del trabajo y darle finalidad a la data tratada, dicha pregunta es:</p>
<p>¿Cómo varía la frecuencia de los principales delitos en Costa Rica entre 2019 y 2025 según la provincia y las características de la víctima (edad y sexo)?</p>
<p>Para dar respuesta a dicha pregunta se procede por relaciones lineales; en este caso, al ser multivariables relacionadas con la frecuencia de delitos, se condensará la respuesta en correlaciones lineales, en específico en la técnica del coeficiente de Pearson, pues identifica qué tan fuerte y en qué dirección se asocian estas variables con los cambios en los delitos a lo largo del tiempo.El mismo se explicara con más detalle continuación.</p>
</section>
<section id="marco-metodológico" class="level2">
<h2 class="anchored" data-anchor-id="marco-metodológico">Marco metodológico</h2>
<section id="enfoque-y-tipo-de-estudio" class="level3">
<h3 class="anchored" data-anchor-id="enfoque-y-tipo-de-estudio">1. Enfoque y tipo de estudio</h3>
<p>El estudio se desarrolla bajo un enfoque cuantitativo, de tipo descriptivo–correlacional, con base en registros administrativos oficiales. Se analizan los delitos cometidos en Costa Rica entre 2019 y 2025 (periodo disponible en la base del OIJ) con el objetivo de identificar patrones de criminalidad por género en los cantones del país y estudiar su relación con variables socioeconómicas como pobreza y desempleo.</p>
<p>La unidad de análisis es el evento delictivo registrado, que luego se agrupa por año, provincia/cantón, sexo y características de la víctima (principalmente edad y sexo). A nivel analítico, se trabaja con unidades agregadas del tipo cantón–año–género, que permiten vincular los delitos con indicadores socioeconómicos oficiales.</p>
</section>
<section id="fuentes-de-información-y-bases-de-datos" class="level3">
<h3 class="anchored" data-anchor-id="fuentes-de-información-y-bases-de-datos">2. Fuentes de información y bases de datos</h3>
<p>Los datos principales de criminalidad provienen de las bases de delitos del Organismo de Investigación Judicial (OIJ) y de las estadísticas policiales consolidadas entre 2019 y julio de 2025. Como apoyo contextual se consideran informes del Observatorio de Seguridad Ciudadana, el Ministerio de Seguridad Pública y los indicadores de desarrollo y género publicados por el PNUD, que incluyen información sobre condiciones socioeconómicas por cantón, como pobreza y desempleo.</p>
</section>
<section id="preparación-y-limpieza-de-los-datos" class="level3">
<h3 class="anchored" data-anchor-id="preparación-y-limpieza-de-los-datos">3. Preparación y limpieza de los datos</h3>
<p>Las bases originales se encontraban separadas por año y con diferencias en nombres de variables y formatos (por ejemplo, “género” vs.&nbsp;“sexo”, o fechas en distintos formatos). Estas se unificaron en una sola base de más de 345 000 registros con 12 variables categóricas (delito, subdelito, fecha, hora, víctima, subvíctima, edad, sexo, nacionalidad, provincia, cantón y distrito).</p>
<p>Para mejorar la calidad de los datos se aplicaron los siguientes pasos:</p>
<ul>
<li><strong>Reclasificación de valores “NO APLICA” y “DESCONOCIDO”</strong> como NA cuando no tenían sentido para el tipo de víctima (por ejemplo, edad o sexo asignados a “VIVIENDA” o “VEHÍCULO”).</li>
<li><strong>Construcción de tablas de frecuencias</strong> para todas las variables categóricas (delito, víctima, edad, sexo, nacionalidad, provincia y cantón) y elaboración de gráficos de barras y mapas coropléticos para describir la distribución espacial de los delitos.</li>
<li><strong>Detección de outliers</strong> en las frecuencias mediante el método del rango intercuartílico (IQR) y <strong>winsorización</strong> de los valores extremos (por ejemplo, cantones o provincias con frecuencias muy altas), con el fin de reducir la distorsión que estos pueden generar en los análisis correlacionales sin eliminar información relevante.</li>
</ul>
<p>A partir de esta base depurada se construyen variables cuantitativas de interés, como frecuencias anuales de delitos por provincia/cantón y sexo, y, cuando la información lo permite, tasas de delitos por población para cada cantón.</p>
</section>
<section id="etapas-del-análisis-estadístico" class="level3">
<h3 class="anchored" data-anchor-id="etapas-del-análisis-estadístico">4. Etapas del análisis estadístico</h3>
<p>Debido a la forma en que está planteada la pregunta de investigación, el análisis se organiza en tres etapas principales:</p>
<section id="etapa-1-frecuencia-de-delitos-a-lo-largo-del-tiempo" class="level4">
<h4 class="anchored" data-anchor-id="etapa-1-frecuencia-de-delitos-a-lo-largo-del-tiempo">4.1. Etapa 1: Frecuencia de delitos a lo largo del tiempo</h4>
<p>En la primera etapa se estudia cómo varía la cantidad de delitos entre 2019 y 2025, desagregada por sexo de la víctima y por provincia. Para ello:</p>
<ul>
<li>Se agrupan los registros por año, sexo y provincia.</li>
<li>Se elaboran tablas de frecuencia y gráficos para mostrar la evolución temporal de los delitos, distinguiendo entre hombres y mujeres.</li>
<li>De esta manera se identifican tendencias generales (incrementos, descensos o estabilidad en el tiempo) y se detectan años críticos para cada grupo.</li>
</ul>
<p>En esta etapa, el año se trata como una variable cuantitativa (2019, 2020, …, 2025), lo que permite explorar si existe una tendencia lineal entre el paso del tiempo y la frecuencia de delitos.</p>
</section>
<section id="etapa-2-delitos-según-características-de-la-víctima-edad-y-sexo" class="level4">
<h4 class="anchored" data-anchor-id="etapa-2-delitos-según-características-de-la-víctima-edad-y-sexo">4.2. Etapa 2: Delitos según características de la víctima (edad y sexo)</h4>
<p>La segunda etapa se centra en la relación entre la frecuencia de delitos y las características de la víctima, especialmente edad y sexo.</p>
<ul>
<li>Se generan tablas de contingencia que cruzan los rangos de edad (menor de edad, mayor de edad, adulto mayor) y el sexo de la víctima, con el número de delitos registrados.</li>
<li>Se calculan porcentajes por grupo (por ejemplo, porcentaje de delitos contra mujeres mayores de edad vs.&nbsp;hombres menores de edad) y se representan mediante gráficos de barras agrupadas o apiladas.</li>
</ul>
<p>Aunque edad y sexo son variables categóricas, al trabajar con sus frecuencias se obtienen indicadores numéricos que permiten describir qué grupos son más afectados y comparar la carga delictiva entre ellos.</p>
</section>
<section id="etapa-3-distribución-espacial-de-los-delitos-por-provincias-y-cantones" class="level4">
<h4 class="anchored" data-anchor-id="etapa-3-distribución-espacial-de-los-delitos-por-provincias-y-cantones">4.3. Etapa 3: Distribución espacial de los delitos por provincias y cantones</h4>
<p>En la tercera etapa se analiza la distribución espacial de los delitos.</p>
<ul>
<li>Se calcula la frecuencia de delitos por cantón, separando por sexo de la víctima.</li>
<li>Esta información se vincula con un shapefile cantonal del INEC para generar mapas de tipo coroplético que permitan visualizar qué cantones concentran mayores niveles de criminalidad y cómo se distribuyen según género.</li>
</ul>
<p>Esta etapa es clave para el objetivo de sectorizar la criminalidad y para preparar el terreno del análisis correlacional con variables socioeconómicas.</p>
</section>
</section>
<section id="análisis-correlacional-con-factores-socioeconómicos" class="level3">
<h3 class="anchored" data-anchor-id="análisis-correlacional-con-factores-socioeconómicos">5. Análisis correlacional con factores socioeconómicos</h3>
<p>Después de caracterizar los patrones temporales, demográficos y espaciales de la criminalidad, se realizó un análisis correlacional con el objetivo de explorar si las tasas de victimización nacionales presentan alguna asociación con indicadores de desarrollo humano y condiciones educativas de la población.</p>
<p>Dado que no fue posible obtener datos cantonales completos de pobreza ni desempleo para todos los años del periodo 2019–2025, el análisis se centró en aquellas variables socioeconómicas disponibles para todos los cantones y que cuentan con series temporales consistentes a nivel nacional. Estas variables provienen del PNUD y del INEC e incluyen:</p>
<ul>
<li><p>IDG-D: Índice de Desarrollo de Género desagregado.</p></li>
<li><p>IDH: Índice de Desarrollo Humano.</p></li>
<li><p>IDH-D: Índice de Desarrollo Humano desagregado.</p></li>
<li><p>Escolaridad femenina: porcentaje de mujeres con al menos educación secundaria.</p></li>
<li><p>Escolaridad masculina: porcentaje de hombres con al menos educación secundaria.</p></li>
</ul>
<p>Para cada año, se construyeron las tasas nacionales de delitos por cada 100 000 habitantes, desagregadas por sexo, a partir de:</p>
<ul>
<li><p>La frecuencia anual de víctimas hombres y mujeres.</p></li>
<li><p>La población total estimada del país.</p></li>
</ul>
<p>Con estas variables se generó una matriz de correlaciones utilizando el coeficiente de Pearson, el cual permite medir la fuerza y dirección de la asociación lineal entre:</p>
<ul>
<li><p>La tasa nacional de víctimas hombres (por 100 000 habitantes).</p></li>
<li><p>La tasa nacional de víctimas mujeres (por 100 000 habitantes).</p></li>
<li><p>Los indicadores IDH, IDH-D, IDG-D.</p></li>
<li><p>Los niveles promedio de escolaridad por sexo.</p></li>
</ul>
<p>El análisis se centra en identificar si los niveles de desarrollo humano, equidad de género y escolaridad presentan alguna relación estadística con el comportamiento de las tasas de criminalidad durante el periodo 2019–2023.</p>
</section>
<section id="justificación-del-uso-del-coeficiente-de-correlación-de-pearson" class="level3">
<h3 class="anchored" data-anchor-id="justificación-del-uso-del-coeficiente-de-correlación-de-pearson">6. Justificación del uso del coeficiente de correlación de Pearson</h3>
<p>El coeficiente de correlación de Pearson (r) es una medida estadística que indica qué tan fuerte y en qué dirección se relacionan dos variables cuantitativas. Su valor va de –1 a +1:</p>
<ul>
<li>Valores cercanos a +1 indican una relación lineal positiva fuerte (cuando una variable aumenta, la otra también).</li>
<li>Valores cercanos a –1 indican una relación lineal negativa fuerte (cuando una sube, la otra tiende a bajar).</li>
<li>Valores cerca de 0 sugieren ausencia de relación lineal clara.</li>
</ul>
<p>En este proyecto se escoge el coeficiente de Pearson por varias razones metodológicas:</p>
<ol type="1">
<li><p><strong>Las variables clave se transforman en cuantitativas.</strong> Las tasas de victimización por cada 100 000 habitantes para hombres y mujeres son variables continuas, al igual que los indicadores socioeconómicos incluidos: IDH, IDH-D, IDG-D y porcentajes de escolaridad. Esto permite aplicar el coeficiente de Pearson.</p></li>
<li><p><strong>Interesa específicamente la relación lineal.</strong> El propósito del análisis es determinar si variaciones en el nivel de desarrollo humano o en la escolaridad se asocian con aumentos o disminuciones en las tasas de criminalidad. Este tipo de relación —del tipo “a mayor desarrollo, menor tasa” o “a mayor escolaridad, menor criminalidad”— corresponde a una relación lineal, precisamente la que Pearson está diseñado para medir.</p></li>
<li><p><strong>Tamaño muestral grande y datos agregados.</strong> Aunque el análisis se realiza a nivel nacional (una observación por año), las series disponibles son consistentes y comparables entre sí, lo cual permite explorar tendencias generales. Además, la estandarización de las tasas y el uso de promedios cantonales de IDH, IDH-D y escolaridad reducen la variabilidad extrema y mejoran la estabilidad de las correlaciones estimadas.</p></li>
<li><p><strong>Interpretación sencilla para la toma de decisiones.</strong> Pearson ofrece un único número fácil de interpretar:</p>
<ul>
<li>|r| entre 0 y 0,3 ≈ relación débil,</li>
<li>|r| entre 0,3 y 0,6 ≈ relación moderada,</li>
<li>|r| mayor a 0,6 ≈ relación fuerte. Esto facilita explicar los resultados a nivel académico y de política pública (por ejemplo, “la criminalidad tiene una correlación moderada y positiva con la pobreza cantonal”).</li>
</ul></li>
<li><p><strong>Posibilidad de comparar por género.</strong> El cálculo de correlaciones separadas para las tasas de víctimas hombres y de víctimas mujeres facilita identificar si los indicadores de desarrollo humano se relacionan de manera distinta con la criminalidad según el género. Esto fortalece el enfoque de género del proyecto y permite identificar patrones específicos de vulnerabilidad.</p></li>
</ol>
</section>
</section>
<section id="conclusiones" class="level2">
<h2 class="anchored" data-anchor-id="conclusiones">Conclusiones</h2>
<p>El análisis de la evolución anual de las víctimas revela que el año 2019 concentra los niveles más altos de criminalidad tanto para hombres como para mujeres. En 2020 se observa un descenso significativo en todas las provincias, probablemente influenciado por las restricciones de movilidad durante la pandemia, lo cual redujo las oportunidades delictivas. A partir de 2021 se identificó un repunte progresivo que alcanza picos en 2023 o 2024 según la provincia. En todo el periodo, los hombres presentan sistemáticamente niveles más altos de victimización que las mujeres, aunque ambos grupos siguen tendencias muy similares. El aparente descenso en 2025 debe interpretarse con cautela, pues corresponde a un año con registros incompletos (enero–julio). Estos resultados muestran que la dinámica delictiva no es aleatoria, sino que sigue ciclos temporales que responden tanto a factores sociales como a condiciones extraordinarias.</p>
<p>Al desagregar los delitos según sexo y rangos de edad, se observa que la mayoría de víctimas corresponden a personas mayores de edad, seguidas (a una distancia considerable) por menores de edad y adultos mayores. En todas las categorías etarias, los hombres representan la mayor proporción de víctimas, aunque las mujeres mantienen una presencia significativa, especialmente en los grupos mayoritarios. Por otra parte, los mapas cantonales muestran que la criminalidad no se distribuye homogéneamente en el territorio nacional. La mayor concentración de delitos se ubica en zonas urbanas densamente pobladas, particularmente en el Gran Área Metropolitana, mientras que regiones periféricas presentan niveles notablemente menores. Estos patrones geográficos revelan desigualdades territoriales que deben considerarse al formular estrategias de prevención y políticas públicas.</p>
<p>Como última conclusión, la correlación entre las tasas nacionales de delitos por sexo y los indicadores encontrados (IDH-H, IDG-G y escolaridad hasta al menos la secundaria por sexo) sugiere que sí existe una relación lineal entre el nivel de desarrollo del país y la evolución general de la criminalidad entre 2019 y 2023. Sin embargo, estas asociaciones deben entenderse con su debida cautela. Pues solo se encuentra una observación general por año, y la falta de indicadores genwrales de pobreza o desempleo a nivel cantonal, en resumen, falta de información. De todas formas, los resultados sugieren que la escolaridad también podría estar relacionada con la dinámica delictiva y que estos deben seguir siendo estudiados con mayor profundidad y con información actualizada. Se concluye en general que la seguridad y el bienestar social no han de ser fenómenos aislados, sino dimensiones correlacionadas que influyen conjuntamente en la realidad delictiva de Costa Rica.</p>
</section>
<section id="limitaciones" class="level2">
<h2 class="anchored" data-anchor-id="limitaciones">Limitaciones</h2>
<p>Las bases de datos del OIJ no venían de forma unificada; sino separadas por año, y además presentaban diferencias en nombres de columnas y extensiones. Por lo tanto se tuvo que crear un script para leer cada año, estandarizar variables y unir todo en una sola base. Aunque esto permitió tener una base de datos unificada, cualquier error manual durante este proceso (sobre todo porque se realizó al inicio del proyecto) podría haber afectado los resultados.</p>
<p>Debido a que las bases de datos traía información de sexo, nacionalidad, edad o subvíctima aún cuando la víctima no era persona (por ejemplo, era un vehículo, vivienda, o empresa) se decidió cambiar todas esas variables a “NO APLICA”. Esto tiene lógica, pues el mismo OIJ aclara que dichas variables describen específicamente a la víctima, y objetos no tienen ni edad ni sexo. Sin embargo, esto también implica que, si por alguna razón en algún registro se había anotado información adicional, como datos del dueño del bien afectado, esa información se pierde.</p>
<p>Como el archivo solo llega hasta julio de 2025, el año se presenta con menos observaciones, lo que a primera vista puede hacer parecer que hubo menos criminalidad en dicho año, cuando en realidad es simplemente que no está completo.</p>
<p>Se aplicó winsonorización para reducir el impacto de los valores extremadamente altos, lo que, aunque mejora la uniformidad (sobretodo en los gráficos), también modifica artificialmente las frecuencias más altas, lo que hace que los datos de cantones con delitos muy altos sean atenuados, subestimando así la concentración de los delitos en estas zonas.</p>
<p>Durante el análisis se usó la división cantonal correspondiente a 2024 para hacer los mapas, pero los años abarcan desde 2019. En esos años hubieron cambios a nivel cantonal, como la creación de Monteverde y Puerto Jiménez como cantones. Esto implica que en los primeros años dichos cantones no tendrán datos registrados en los mapas, pues esos datos se registraron sobre el cantón al que pertenecían antiguamente. Por tanto, en el análisis de los cantones que sufrieron este fénomeno se debe tener especial cuidado.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>